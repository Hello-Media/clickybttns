<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HelloMedia.us | HelloClickyBttns v7 - Custom button generator. Ready in seconds.</title>
    
    <!-- SEO & Social Sharing Tags -->
    <meta name="description" content="Generate high-converting CTA buttons for Notion, Mailchimp, and websites. Free tool by HelloMedia.us.">
    <meta property="og:title" content="HelloClickyBttns | Custom Button Studio">
    <meta property="og:description" content="Create beautiful, click-worthy buttons for your emails and docs in seconds. No design skills needed.">
    <meta property="og:image" content="https://hellomedia.us/assets/social-card.png">
    <meta property="og:url" content="https://hellomedia.us/marketing-tools/helloclickybttns-button-maker">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Fix for Google API Referrer Check -->
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîò</text></svg>">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f8f9fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 40px 20px;
            box-sizing: border-box;
            color: #333;
            user-select: none;
            -webkit-user-select: none;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title-box {
            display: inline-block;
            margin-bottom: 20px; 
            font-size: 28px;
            font-weight: 800;
            color: #333;
            text-decoration: none;
            border: 2px solid #e1e4e8;
            padding: 12px 24px;
            border-radius: 16px;
            background: #fff;
            transition: all 0.2s ease;
            letter-spacing: -0.5px;
        }
        
        .title-box:hover {
            border-color: #333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        h1 { 
            margin: 0 0 10px 0; 
            letter-spacing: -1px; 
            font-weight: 800;
            font-size: 36px;
        }
        
        .brand-highlight { color: #007aff; }
        p { color: #666; margin: 0; line-height: 1.5; }
        .use-cases { font-size: 14px; color: #888; margin-top: 8px; }

        .preview-area {
            margin-bottom: 30px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        canvas {
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 100%;
            height: auto;
            border-radius: 0; 
            transition: all 0.2s ease-out;
            background-color: transparent;
            margin-bottom: 20px;
            display: block; 
            margin-left: auto; 
            margin-right: auto;
            user-select: none;
            -webkit-user-select: none;
        }
        
        .geometry-stack {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            width: 100%; 
        }

        .shape-toolbar {
            display: flex;
            background: white;
            padding: 4px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
            gap: 4px;
            justify-content: center;
        }

        .shape-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .shape-btn:hover { background: #f5f5f5; }
        .shape-btn.active { background: #eef2ff; color: #007aff; }

        .size-toolbar {
            display: flex;
            align-items: center;
            background: white;
            padding: 6px;
            border-radius: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            gap: 10px;
            border: 1px solid rgba(0,0,0,0.05);
            justify-content: center;
        }

        .size-control-btn {
            background: transparent;
            border: none;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .size-control-btn:hover { background: #f0f0f0; color: #007aff; }
        .size-control-btn:active { transform: scale(0.96); }
        
        .size-badge {
            background: #333;
            color: white;
            font-size: 12px;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
            font-family: monospace;
            min-width: 100px;
            text-align: center;
        }

        .controls {
            background: white;
            padding: 30px;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            color: #999;
            letter-spacing: 1px;
            margin-bottom: 15px;
            display: block;
        }

        .input-group { display: flex; gap: 12px; align-items: center; }

        input[type="text"] {
            padding: 14px;
            font-size: 16px;
            border: 2px solid #eee;
            border-radius: 12px;
            flex-grow: 1;
            outline: none;
            transition: border-color 0.2s;
            font-family: inherit;
            width: 100%;
            user-select: text;
            -webkit-user-select: text;
        }
        input[type="text"]:focus { border-color: #007aff; }
        
        .color-row { display: flex; gap: 20px; align-items: center; margin-bottom: 15px; }
        
        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #f8f9fa;
            padding: 10px 14px;
            border-radius: 12px;
            border: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
            flex: 1;
        }
        .color-picker-wrapper:hover { background: #f1f3f5; border-color: #ddd; }
        
        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 38px;
            height: 38px;
            cursor: pointer;
            background: none;
            padding: 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.1);
            vertical-align: middle;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 8px; }
        
        .color-label { font-size: 14px; font-weight: 600; color: #444; display: flex; align-items: center; gap: 6px; }

        .presets { display: flex; gap: 10px; flex-wrap: wrap; }
        
        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            position: relative;
            transition: transform 0.2s;
        }
        .theme-btn:hover { transform: scale(1.1); }
        .theme-btn::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 12px; height: 12px;
            background: currentColor;
            border-radius: 50%;
        }

        .btn {
            padding: 14px 24px;
            font-size: 16px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            border: none;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary { 
            background-color: #111; 
            color: white; 
            flex-shrink: 0; 
            white-space: nowrap; 
        }
        .btn-primary:hover { background-color: #000; transform: translateY(-1px); }

        .btn-magic { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; width: 100%; }
        .btn-magic:hover { opacity: 0.95; }
        .btn-magic:disabled { opacity: 0.6; cursor: wait; }

        .ai-panel { background: #f0f7ff; border-radius: 16px; padding: 20px; border: 1px solid #cce4ff; position: relative; transition: opacity 0.3s, filter 0.3s; }
        .ai-panel.locked-teaser { opacity: 0.5; filter: grayscale(0.8); }
        .ai-click-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; cursor: pointer; display: none; align-items: center; justify-content: center; }
        .ai-panel.locked-teaser .ai-click-overlay { display: flex; }
        .lock-indicator { background: #333; color: white; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 700; box-shadow: 0 4px 10px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.2s; transform: translateY(10px); }
        .ai-panel.locked-teaser:hover .lock-indicator { opacity: 1; transform: translateY(0); }
        
        .suggestions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-top: 15px; }
        .chip { background: white; border: 1px solid #e1e4e8; border-radius: 12px; padding: 10px; font-size: 13px; color: #444; cursor: pointer; text-align: center; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .chip:hover { border-color: #667eea; color: #5c6ac4; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(102, 126, 234, 0.15); }
        .status-msg { font-size: 13px; margin-top: 10px; text-align: center; font-style: italic; color: #666; min-height: 20px; }

        /* --- SLEEK DARK OVERLAY --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(8px);
        }
        .modal-card {
            background: white; width: 90%; max-width: 480px; padding: 40px; border-radius: 24px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5); text-align: center;
            animation: slideUp 0.4s cubic-bezier(0.19, 1, 0.22, 1); position: relative;
        }
        @keyframes slideUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-icon { font-size: 40px; margin-bottom: 20px; display: block; }
        .modal-title { font-size: 26px; margin-bottom: 12px; font-weight: 800; color: #111; letter-spacing: -0.5px; }
        .modal-text { color: #555; margin-bottom: 30px; line-height: 1.6; font-size: 16px; }
        
        .close-btn-x { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; color: #aaa; cursor: pointer; line-height: 1; padding: 5px; transition: color 0.2s; }
        .close-btn-x:hover { color: #333; }
        
        .modal-form input {
            width: 100%; padding: 16px; border: 2px solid #eee; border-radius: 12px; font-size: 16px; box-sizing: border-box; margin-bottom: 15px;
            background: #f9f9f9; transition: all 0.2s; user-select: text; -webkit-user-select: text;
        }
        .modal-form input:focus { border-color: #007aff; background: white; outline: none; }
        
        .btn-unlock {
            background: linear-gradient(135deg, #007aff 0%, #0056b3 100%); color: white; width: 100%; padding: 16px;
            border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,122,255,0.3); transition: transform 0.2s;
        }
        .btn-unlock:hover { transform: translateY(-2px); }
        
        .btn-skip { background: transparent; border: none; color: #777; margin-top: 20px; font-size: 14px; cursor: pointer; font-weight: 500; transition: color 0.2s; }
        .btn-skip:hover { color: #333; text-decoration: underline; }
        
        .footer-links { margin-top: 40px; font-size: 12px; color: #aaa; }
        .footer-links a { color: #aaa; text-decoration: none; margin: 0 8px; }
        .footer-links a:hover { text-decoration: underline; color: #666; }
        
        .limit-badge { background: #eee; color: #555; font-size: 11px; padding: 4px 8px; border-radius: 4px; display: inline-block; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="header">
        <a href="https://HelloMedia.us" class="title-box">HelloMedia.us</a>
        <h1>Hello<span class="brand-highlight">ClickyBttns</span></h1>
        
        <p style="font-size: 18px; margin-top: 10px; color: #444;">Custom button generator. Ready in seconds.</p>
        <p class="use-cases">Works with Notion, Mailchimp, Substack, emails, landing pages & link-in-bios.</p>
        <p style="font-size: 14px; color: #999; margin-top: 5px;">No design skills needed.</p>
    </div>

    <div class="preview-area">
        <canvas id="buttonCanvas" oncontextmenu="return preventRightClick(event)"></canvas>
        
        <div class="geometry-stack">
            <div class="shape-toolbar">
                <button type="button" class="shape-btn" onclick="setShape('rectangle', this)">Rectangle</button>
                <button type="button" class="shape-btn active" onclick="setShape('rounded', this)">Rounded</button>
                <button type="button" class="shape-btn" onclick="setShape('pill', this)">Pill</button>
                <button type="button" class="shape-btn" onclick="setShape('square', this)">Square</button>
            </div>

            <div class="size-toolbar">
                <button type="button" class="size-control-btn" onclick="resizeButton(-1)">
                    <span style="font-size: 16px; font-weight:800;">Ôºç</span> Smaller
                </button>
                <div class="size-badge" id="sizeBadge">600 x 120px</div>
                <button type="button" class="size-control-btn" onclick="resizeButton(1)">
                    Larger <span style="font-size: 16px; font-weight:800;">Ôºã</span>
                </button>
            </div>
        </div>
    </div>
    
    <div class="controls">
        <div>
            <label class="section-title">Button Text</label>
            <div class="input-group">
                <input type="text" id="btnText" value="Edit Button Text Below" oninput="drawButton()" placeholder="Button text...">
                <button class="btn btn-primary" onclick="checkDownload()">Download Button</button>
            </div>
        </div>

        <div>
            <label class="section-title">Color Themes</label>
            <div class="presets" id="themeContainer"></div>
            <div style="height: 15px;"></div>
            <div class="color-row">
                <label class="color-picker-wrapper">
                    <input type="color" id="bgColorPicker" value="#007aff" oninput="drawButton()">
                    <span class="color-label">üé® Button Color</span>
                </label>
                <label class="color-picker-wrapper">
                    <input type="color" id="textColorPicker" value="#ffffff" oninput="drawButton()">
                    <span class="color-label">üî§ Text Color</span>
                </label>
            </div>
        </div>

        <div class="ai-panel" id="aiPanel">
            <div class="ai-click-overlay" onclick="triggerGate('ai')">
                <div class="lock-indicator">üîí Unlock Writing Helper</div>
            </div>
            
            <label class="section-title">‚ú® Writing Helper <span id="aiLockBadge" class="limit-badge" style="display:none">LOCKED</span></label>
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <input type="text" id="aiPrompt" placeholder="Describe your button (e.g. 'Coffee shop signup')">
            </div>
            <button type="button" class="btn btn-magic" onclick="checkAI()">
                Generate Text Ideas
            </button>
            <div id="statusMsg" class="status-msg"></div>
            <div id="suggestionsArea" class="suggestions-grid"></div>
        </div>

        <div class="footer-links" style="text-align: center;">
            <a href="https://hellomedia.us/privacy" target="_blank">Privacy Policy</a> ‚Ä¢ 
            <a href="https://hellomedia.us" target="_blank">HelloMedia.us</a>
        </div>
    </div>

    <div id="limitModal" class="modal-overlay">
        <div class="modal-card">
            <button class="close-btn-x" onclick="closeModal()">√ó</button>
            <span class="modal-icon">‚ú®</span>
            <div class="modal-title">Unlock Unlimited Power</div>
            <p class="modal-text" id="modalMessage">You've reached the free limit. Enter your email to remove the watermark and unlock the Writing Helper forever.</p>
            <form class="modal-form" onsubmit="unlockPremium(event)">
                <input type="email" id="emailInput" placeholder="name@example.com" required>
                <button type="submit" class="btn-unlock">Unlock Everything</button>
            </form>
            <button id="skipBtn" class="btn-skip" onclick="skipToWatermark()">No thanks, I'll keep the watermark</button>
        </div>
    </div>

    <script>
        (function() {
            document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || (e.ctrlKey && e.key === 'u')) { e.preventDefault(); }
            });

            const canvas = document.getElementById('buttonCanvas');
            const ctx = canvas.getContext('2d');
            const input = document.getElementById('btnText');
            const sizeBadge = document.getElementById('sizeBadge');
            const bgColorPicker = document.getElementById('bgColorPicker');
            const textColorPicker = document.getElementById('textColorPicker');
            const aiPanel = document.getElementById('aiPanel');
            
            const WEBHOOK_URL = ""; 
            let currentWidth = 600; let currentHeight = 120; let currentFontSize = 36; let shapeType = 'rounded'; 
            
            // --- UPDATED LIMITS ---
            const FREE_LIMIT = 3;  // Downloads
            const AI_LIMIT = 3;    // AI specific limit
            let aiUsageCount = parseInt(localStorage.getItem('hcb_ai_usage') || '0');
            
            const INTERACTION_LIMIT = 100; // Interaction Budget
            
            let usageCount = parseInt(localStorage.getItem('hcb_usage') || '0');
            let interactionCount = parseInt(localStorage.getItem('hcb_interactions') || '0');
            let isPremium = localStorage.getItem('hcb_premium') === 'true';
            
            // AI THROTTLE STATE
            let lastGenTime = 0;

            const apiKey = ""; 

            const themes = [{ name: 'Classic Blue', bg: '#007aff', text: '#ffffff' }, { name: 'Midnight', bg: '#000000', text: '#ffffff' }, { name: 'Clean', bg: '#ffffff', text: '#000000' }, { name: 'Forest', bg: '#2d6a4f', text: '#d8f3dc' }, { name: 'Sunset', bg: '#e76f51', text: '#ffffff' }, { name: 'Berry', bg: '#8338ec', text: '#ffffff' }, { name: 'Neon', bg: '#ccff33', text: '#000000' }, { name: 'Coral', bg: '#ff6b6b', text: '#ffffff' }];

            window.onload = function() {
                renderThemes(); drawButton(); updateLockUI();
            };

            window.preventRightClick = function(e) {
                e.preventDefault();
                alert("Please use the 'Download Button' below to save your button!");
                return false;
            }

            window.resizeButton = function(dir) {
                const wStep = 40; const hStep = 10; const fStep = 3;
                if (shapeType === 'square') {
                    currentWidth += (wStep * dir);
                    if (currentWidth < 100) currentWidth = 100;
                    currentHeight = currentWidth;
                    currentFontSize = Math.round(currentWidth * 0.15); 
                } else {
                    currentWidth += (wStep * dir);
                    currentHeight += (hStep * dir);
                    currentFontSize += (fStep * dir);
                    if (currentWidth < 100) currentWidth = 100;
                    if (currentHeight < 40) currentHeight = 40;
                }
                if (currentFontSize < 10) currentFontSize = 10;
                drawButton();
            }

            window.setShape = function(shape, btnElement) {
                document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
                btnElement.classList.add('active');
                shapeType = shape;
                if (shapeType === 'square') {
                    currentWidth = 250; currentHeight = 250;
                    currentFontSize = Math.round(currentWidth * 0.15);
                } else if (currentWidth === currentHeight && shapeType !== 'square') {
                    currentWidth = 600; currentHeight = 120; currentFontSize = 36;
                }
                drawButton();
            }

            window.drawButton = function() {
                if (!isPremium) {
                    interactionCount++;
                    localStorage.setItem('hcb_interactions', interactionCount);
                }
                updateLockUI();

                canvas.width = currentWidth; canvas.height = currentHeight;
                ctx.clearRect(0, 0, currentWidth, currentHeight);
                
                let radius = 0;
                if (shapeType === 'rounded') radius = (currentHeight < 120) ? 15 : 30; 
                if (shapeType === 'pill') radius = currentHeight / 2;

                ctx.fillStyle = bgColorPicker.value;
                ctx.beginPath();
                ctx.moveTo(radius, 0);
                ctx.lineTo(currentWidth - radius, 0);
                ctx.quadraticCurveTo(currentWidth, 0, currentWidth, radius);
                ctx.lineTo(currentWidth, currentHeight - radius);
                ctx.quadraticCurveTo(currentWidth, currentHeight, currentWidth - radius, currentHeight);
                ctx.lineTo(radius, currentHeight);
                ctx.quadraticCurveTo(0, currentHeight, 0, currentHeight - radius);
                ctx.lineTo(0, radius);
                ctx.quadraticCurveTo(0, 0, radius, 0);
                ctx.closePath();
                ctx.fill();

                ctx.fillStyle = textColorPicker.value;
                const maxTextWidth = currentWidth * 0.85; 
                let calculatedFontSize = currentFontSize;
                ctx.font = `bold ${calculatedFontSize}px -apple-system, BlinkMacSystemFont, 'Segoe UI Emoji', 'Apple Color Emoji', 'Segoe UI', Roboto, sans-serif`;
                const textWidth = ctx.measureText(input.value).width;
                if (textWidth > maxTextWidth) {
                    const ratio = maxTextWidth / textWidth;
                    calculatedFontSize = Math.floor(calculatedFontSize * ratio);
                    if (calculatedFontSize < 8) calculatedFontSize = 8;
                }
                ctx.font = `bold ${calculatedFontSize}px -apple-system, BlinkMacSystemFont, 'Segoe UI Emoji', 'Apple Color Emoji', 'Segoe UI', Roboto, sans-serif`;
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(input.value, currentWidth / 2, currentHeight / 2);

                if ((usageCount >= FREE_LIMIT || interactionCount >= INTERACTION_LIMIT) && !isPremium) {
                    applyWatermarkToCanvas();
                }
            }

            window.checkDownload = function() {
                if (isPremium) { performDownload(false); return; }
                usageCount++; localStorage.setItem('hcb_usage', usageCount);
                updateLockUI(); 
                if (usageCount > FREE_LIMIT || interactionCount >= INTERACTION_LIMIT) {
                    window.drawButton(); 
                    document.getElementById('modalMessage').textContent = "You've hit your free download limit! Enter your email to remove the 'HelloMedia.us' watermark.";
                    document.getElementById('skipBtn').style.display = 'block'; 
                    document.getElementById('limitModal').style.display = 'flex';
                } else {
                    performDownload(false);
                }
            }

            window.checkAI = function() {
                if (isPremium) { 
                    checkThrottleAndRun(); 
                    return; 
                }

                aiUsageCount++;
                localStorage.setItem('hcb_ai_usage', aiUsageCount);
                updateLockUI();

                if (aiUsageCount > AI_LIMIT || interactionCount >= INTERACTION_LIMIT) {
                    triggerGate('ai');
                } else {
                    checkThrottleAndRun();
                }
            }
            
            function checkThrottleAndRun() {
                const now = Date.now();
                if (now - lastGenTime < 10000) { // 10 second throttle
                    alert("Please wait 10 seconds between generations to prevent API overload.");
                    return;
                }
                lastGenTime = now;
                generateIdeas();
            }

            window.triggerGate = function(source) {
                if (source === 'ai') {
                    document.getElementById('modalMessage').textContent = "The Writing Helper is a premium feature. Enter your email to unlock it instantly.";
                    document.getElementById('skipBtn').style.display = 'none'; 
                    document.getElementById('limitModal').style.display = 'flex';
                }
            }
            
            window.unlockPremium = async function(e) {
                e.preventDefault();
                const emailInput = document.getElementById('emailInput');
                const email = emailInput.value;
                const btn = document.querySelector('.btn-unlock');

                if (!email || !email.includes('@')) { alert('Please enter a valid email.'); return; }
                btn.textContent = "Unlocking..."; btn.disabled = true;

                if (!WEBHOOK_URL) { setTimeout(() => { completeUnlock(); }, 800); return; }

                try {
                    await fetch(WEBHOOK_URL, {
                        method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: email, source: 'HelloClickyBttns' })
                    });
                    completeUnlock();
                } catch (err) {
                    console.error(err); alert("Something went wrong. Please try again.");
                    btn.textContent = "Unlock Everything"; btn.disabled = false;
                }
            }
            
            window.skipToWatermark = function() {
                document.getElementById('limitModal').style.display = 'none';
                performDownload(true); 
            }
            
            window.closeModal = function() { document.getElementById('limitModal').style.display = 'none'; }

            function updateLockUI() {
                const isAiLocked = (aiUsageCount >= AI_LIMIT || interactionCount >= INTERACTION_LIMIT) && !isPremium;
                if (isAiLocked) {
                    aiPanel.classList.add('locked-teaser');
                    document.getElementById('aiLockBadge').style.display = 'inline-block';
                } else {
                    aiPanel.classList.remove('locked-teaser');
                    document.getElementById('aiLockBadge').style.display = 'none';
                }
            }

            function applyWatermarkToCanvas() {
                ctx.save(); ctx.globalAlpha = 0.5; ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
                ctx.shadowColor = "rgba(0, 0, 0, 0.3)"; ctx.shadowBlur = 2;
                
                let wmSize = Math.max(10, Math.floor(currentHeight * 0.15));
                ctx.font = `bold ${wmSize}px sans-serif`;
                
                const wmText = "HelloMedia.us";
                let rightOffset = 10; let bottomOffset = 5;
                if (shapeType === 'pill') { rightOffset = Math.max(10, (currentHeight / 2) * 0.4); }

                let textWidth = ctx.measureText(wmText).width;
                const maxWmWidth = currentWidth - (rightOffset + 20); 
                if (textWidth > maxWmWidth) {
                    const ratio = maxWmWidth / textWidth; wmSize = Math.floor(wmSize * ratio);
                    ctx.font = `bold ${wmSize}px sans-serif`;
                }

                ctx.textAlign = "right"; ctx.textBaseline = "bottom";
                ctx.fillText(wmText, currentWidth - rightOffset, currentHeight - bottomOffset);
                ctx.restore();
            }

            function performDownload(addWatermark) {
                if (!addWatermark) {
                    // Quick redraw clean
                    canvas.width = currentWidth; canvas.height = currentHeight;
                    ctx.clearRect(0, 0, currentWidth, currentHeight);
                    let radius = 0;
                    if (shapeType === 'rounded') radius = (currentHeight < 120) ? 15 : 30; 
                    if (shapeType === 'pill') radius = currentHeight / 2;
                    ctx.fillStyle = bgColorPicker.value;
                    ctx.beginPath();
                    ctx.moveTo(radius, 0); ctx.lineTo(currentWidth - radius, 0);
                    ctx.quadraticCurveTo(currentWidth, 0, currentWidth, radius);
                    ctx.lineTo(currentWidth, currentHeight - radius);
                    ctx.quadraticCurveTo(currentWidth, currentHeight, currentWidth - radius, currentHeight);
                    ctx.lineTo(radius, currentHeight);
                    ctx.quadraticCurveTo(0, currentHeight, 0, currentHeight - radius);
                    ctx.lineTo(0, radius);
                    ctx.quadraticCurveTo(0, 0, radius, 0);
                    ctx.closePath(); ctx.fill();

                    ctx.fillStyle = textColorPicker.value;
                    const maxTextWidth = currentWidth * 0.85; 
                    let calculatedFontSize = currentFontSize;
                    ctx.font = `bold ${calculatedFontSize}px -apple-system, BlinkMacSystemFont, 'Segoe UI Emoji', 'Apple Color Emoji', 'Segoe UI', Roboto, sans-serif`;
                    const textWidth = ctx.measureText(input.value).width;
                    if (textWidth > maxTextWidth) {
                        const ratio = maxTextWidth / textWidth;
                        calculatedFontSize = Math.floor(calculatedFontSize * ratio);
                        if (calculatedFontSize < 8) calculatedFontSize = 8;
                    }
                    ctx.font = `bold ${calculatedFontSize}px -apple-system, BlinkMacSystemFont, 'Segoe UI Emoji', 'Apple Color Emoji', 'Segoe UI', Roboto, sans-serif`;
                    ctx.textAlign = "center"; ctx.textBaseline = "middle";
                    ctx.fillText(input.value, currentWidth / 2, currentHeight / 2);
                } else {
                    window.drawButton(); 
                }

                const link = document.createElement('a');
                link.download = `HelloClickyBttns-HelloMedia.us-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                setTimeout(window.drawButton, 500);
            }

            function applyTheme(bg, text) { bgColorPicker.value = bg; textColorPicker.value = text; window.drawButton(); }
            function renderThemes() {
                const container = document.getElementById('themeContainer');
                themes.forEach(t => {
                    const btn = document.createElement('div');
                    btn.className = 'theme-btn';
                    btn.style.backgroundColor = t.bg;
                    btn.style.color = t.text;
                    btn.title = t.name;
                    btn.onclick = () => applyTheme(t.bg, t.text);
                    container.appendChild(btn);
                });
            }
            
            function completeUnlock() {
                isPremium = true;
                localStorage.setItem('hcb_premium', 'true');
                document.getElementById('limitModal').style.display = 'none';
                updateLockUI();
                alert("Thanks! You have unlocked unlimited access.");
                window.drawButton(); 
            }

            async function generateIdeas() {
                const promptText = document.getElementById('aiPrompt').value.trim();
                const status = document.getElementById('statusMsg');
                const area = document.getElementById('suggestionsArea');
                const btn = document.querySelector('.btn-magic');

                if (!promptText) { status.textContent = "Please enter a description first."; return; }
                status.textContent = "Brainstorming..."; status.style.color = "#666"; area.innerHTML = ''; btn.disabled = true;

                try {
                    const systemInstruction = `You are a UX Microcopy Expert. 
                    Generate 6 catchy, high-converting button text options (max 5 words each).
                    Include a relevant emoji at the end of every option.
                    Output ONLY the raw text lines separated by newlines.`;
                    const userQuery = `Context: ${promptText}`;

                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: userQuery }] }],
                                systemInstruction: { parts: [{ text: systemInstruction }] }
                            })
                        }
                    );

                    if (!response.ok) throw new Error("API Error");
                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (text) {
                        const ideas = text.split('\n').filter(line => line.trim().length > 0);
                        ideas.forEach(idea => {
                            const cleanIdea = idea.replace(/^\d+[\.\)]\s*/, '').trim();
                            const el = document.createElement('div');
                            el.className = 'chip';
                            el.textContent = cleanIdea;
                            el.onclick = () => { input.value = cleanIdea; window.drawButton(); };
                            area.appendChild(el);
                        });
                        status.textContent = "Click a suggestion to apply it!";
                        status.style.color = "#2d6a4f";
                    }
                } catch (err) {
                    console.error(err); status.textContent = "Could not generate ideas. Try again."; status.style.color = "#d93025";
                } finally {
                    btn.disabled = false;
                }
            }
        })();
    </script>

</body>
</html>
